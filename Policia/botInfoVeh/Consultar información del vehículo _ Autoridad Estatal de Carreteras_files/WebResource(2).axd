!function(e){if("undefined"!=typeof epi&&void 0!==epi.EPiServer&&void 0!==epi.EPiServer.Forms)if(void 0!==e){var t=function(e,t){this.workingFormInfo=t.workingFormInfo,this.dependantInfo=e,this.$domElement=i.getFormElementBlock(e.fieldName,this.workingFormInfo.$workingForm),this.onDependencyStateChanged=t.onDependencyStateChanged,this.dependency=new epi.EPiServer.Forms.Dependency.Dependant(e,t.workingFormInfo),this._registerEventListener(this.dependency),this.isSatisfied=this.dependency.isSatisfied,"function"==typeof this.onDependencyStateChanged&&this.onDependencyStateChanged(this.$domElement,this.dependantInfo,this.isSatisfied),this.check()};t.prototype={_registerEventListener:function(t){var n=this;e(t).on("change",function(e,t){n.onDependencyChangeHandler.call(n,t)})},onDependencyChangeHandler:function(t){this.isSatisfied!==t.isSatisfied&&(this.isSatisfied=t.isSatisfied,this._executeAction(),"function"==typeof this.onDependencyStateChanged&&this.onDependencyStateChanged(this.$domElement,this.dependantInfo,this.isSatisfied),e(this.$domElement).trigger("formsDependencyStateChanged"))},check:function(){this.dependency.runCheck()},_executeAction:function(){if(this.dependantInfo.action){var e=epi.EPiServer.Forms.Dependency.Actions,t=this.dependantInfo.action.clientsideAction;e[t]&&"function"==typeof e[t]&&e[t](this)}}};var n=function(e,t){this.workingFormInfo=t,this.conditions=e.conditions,this.conditionCombination=e.conditionCombination,this.isSatisfied=null,this._registerEventListener()};n.prototype={_registerEventListener:function(){if(this.conditions&&!(this.conditions.length<=0))for(var t=this,n=[],a=0;a<this.conditions.length;a++){var r=this.conditions[a];if(-1===n.indexOf(r.fieldName)){var o=i.getFormElementBlock(r.fieldName,this.workingFormInfo.$workingForm),s=e("[data-f-datainput]",o),d=l._getTriggerEventsForDependeeElement(o);d&&d.length>0&&e.each(d,function(e,n){"change"!==n?s[n](i.debounce(function(e){e.stopPropagation(),t._handleValueChange()},epi.EPiServer.Forms.ThrottleTimeout,t)):s[n](function(){t._handleValueChange.apply(t)})}),e(o).on("formsDependencyStateChanged",function(e,n){t._handleValueChange.apply(t)}),n.push(r.fieldName)}}},runCheck:function(){this._handleValueChange()},_handleValueChange:function(){var t=this.isSatisfied;this.isSatisfied=this._checkSatisfaction(),this.isSatisfied!==t&&e(this).trigger("change",{isSatisfied:this.isSatisfied})},_checkSatisfaction:function(){if(!this.conditions||this.conditions.length<=0)return!0;for(var e=0;e<this.conditions.length;e++){var t=this.conditions[e],n=this._getFieldState(t.fieldName),i=epi.EPiServer.Forms.DependConditions[t.operator];if("function"==typeof i){var a=i(n.value,t.fieldValue);if(a&&this.conditionCombination===epi.EPiServer.Forms.Dependency.ConditionCombinations.Any)return!0;if(!a&&this.conditionCombination!==epi.EPiServer.Forms.Dependency.ConditionCombinations.Any)return!1}}return!(this.conditionCombination===epi.EPiServer.Forms.Dependency.ConditionCombinations.Any)},_getFieldState:function(e){var t=i.getFormElementBlock(e,this.workingFormInfo.$workingForm);return t?{value:epi.EPiServer.Forms.Dependency._getValueOfDependeeElement(t,this.workingFormInfo)}:null}};var i=epi.EPiServer.Forms.Utils,a=epi.EPiServer.Forms.Data,r=epi.EPiServer.Forms.Extension,o=epi.EPiServer.Forms.Validation,s=epi.EPiServer.Forms.Navigation,l=epi.EPiServer.Forms.Dependency;epi.EPiServer.Forms.__DebounceTimer=null,epi.EPiServer.Forms.__Initialized=!(void 0===epi.EPiServer.Forms.__Initialized),e.extend(!0,epi.EPiServer.Forms,{Utils:{debounce:function(e,t,n){return function(){!function(e,n,i,a){clearTimeout(a.__DebounceTimer),a.__DebounceTimer=setTimeout(function(){n.apply(e,i)},t)}(this,e,arguments,n||epi.EPiServer.Forms)}},isInactiveField:function(e,t){return l._isInactiveElement(t,e)},loadExternalScriptOnDemand:function(e,t,n){var a=document.getElementsByTagName("head")[0],r=0,o=e.length,s=null,l=null;for(i.LoadedScripts=i.LoadedScripts||[];r<o;r++)s=e[r],i.LoadedScripts.indexOf(s)>=0||((l=document.createElement("script")).type="text/javascript",l.async=n||!1,l.defer=n||!1,l.src=s,a.appendChild(l),i.LoadedScripts.push(s));l?i._setupCallback(l,t):t()},loadExternalCssOnDemand:function(e,t){for(var n=document.getElementsByTagName("head")[0],a=0,r=e.length,o=null;a<r;a++){o=e[a];var s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",o),n.appendChild(s),a===r-1&&i._setupCallback(s,t)}},_setupCallback:function(e,t){"function"==typeof t&&(e.onload=t,e.onreadystatechange=function(){"complete"===this.readyState&&t()})},stringFormat:function(e,t){for(var n=e,i=t.length;i--;)n=n.replace(new RegExp("\\{"+i+"\\}","gm"),t[i]||"");return n},getConcatString:function(e,t){return e instanceof Array?e.join(t):e},htmlEncodeEntities:function(t){return e("<div></div>").text(t).html()},htmlDecodeEntities:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},isMatchedReg:function(e,t){try{var n=new RegExp(t).exec(e);return null!=n&&n.length>0}catch(e){return console.debug(e.message),!1}},raiseFormsEvent:function(t,n){var i=e.extend(!0,{type:"forms",workingFormInfo:t},n);if(t)t.$workingForm.triggerHandler(i);else{var a=e('.EPiServerForms:eq(0), [data-f-type="form"]:first');(!a||a.length<1)&&(a=e("body")),a.triggerHandler(i)}},injectVisitorData:function(t){var n=e(".FormHidden[data-epiforms-visitordatasources], [data-f-visitordatasources]",t.$workingForm);if(n&&0!==n.length){var i=null;n.each(function(){if((i=e(this))&&i.length>0){var t=null,n=i.data("epiforms-visitordatasources")||i.data("f-visitordatasources");e(n.split(",")).each(function(e,n){"function"==typeof(t=epi.EPiServer.Forms.VisitorData[n])&&t(i)})}})}},isElementType:function(e,t){return e.data("f-type")===t},getElementName:function(e){return e.attr("name")||e.data("epiforms-element-name")||e.data("f-element-name")},getElementValue:function(t){return t.hasClass("FormFileUpload")||i.isElementType(t,"fileupload")?i.getPreviousPostedFiles(t):t.hasClass("FormChoice")||i.isElementType(t,"choice")?t.find(".FormChoice__Input:checked, [data-f-datainput]:checked").map(function(t,n){return e(n).val()}).get():t.hasClass("FormSelection")||i.isElementType(t,"selection")?[].concat(t.find("select").val()):t.hasClass("FormCaptcha")||t.hasClass("FormTextbox")||t.hasClass("FormTextbox--Textarea")||i.isElementType(t,"captcha")||i.isElementType(t,"textbox")?e(".FormTextbox__Input, [data-f-datainput]",t).val().trim():t.hasClass("FormRange")||i.isElementType(t,"range")?e(".FormRange__Input, [data-f-datainput]",t).val().trim():t.hasClass("Form__CustomElement")||i.isElementType(t,"custom")?epi.EPiServer.Forms.Extension.getCustomElementValue(t):i.getNonSpecificElementValue(t)},getFormStepBlock:function(e,t){return console.warn("This is obsolete. Use getFormElementBlock() instead."),i.getFormElementBlock(e,t)},getFormElementBlock:function(t,n){if(!t)return[];var i=e(".Form__Element [data-epiforms-element-name='"+t+"']",n);return i&&0!==i.length||(i=e("[data-f-element-name='"+t+"']",n)),i},getWorkingFormFromInnerElement:function(t){return e(t).parents(".EPiServerForms:first, [data-f-type='form']:first")},getFormIdentifier:function(e){return e.prop("id")},getPreviousPostedFiles:function(t){var n=t.find(".FormFileUpload__Input, [data-f-datainput]"),a=i.getElementName(n),r=i.getWorkingFormFromInnerElement(n),o=epi.EPiServer.Forms.Utils.getFormIdentifier(r),s=epi.EPiServer.Forms.Data.loadFormDataFromStorage(o),l=n[0].files;return e.each(s,function(e,t){if(e.indexOf("__TempData")>-1&&e.replace("__TempData","")==a&&0===l.length)return l=t,!1}),l},getNonSpecificElementValue:function(t){if(!t.attr("data-f-element-name"))return t.val().trim();var n=t.find(":input");if(0===n.length)return t.val().trim();if("input"!=n[0].tagName.toLowerCase())return e(n[0]).val().trim();var i=n[0].type.toLowerCase();return"checkbox"==i||"radio"==i?n.filter(":checked").map(function(t,n){return e(n).val()}).get():e(n[0]).val().trim()},getCurrentStepIndex:function(t){var n=e("input[name=__FormCurrentStepIndex]",t.$workingForm).val();return void 0===n||""===n.trim()||isNaN(+n)||+n>t.StepsInfo.Steps.length-1?t.StepsInfo.AllStepsAreNotLinked?n=0:e.each(t.StepsInfo.Steps,function(e,i){if(i.attachedContentLink==epi.EPiServer.CurrentPageLink&&r.isStepSatisfyDependentCondition(i,t))return n=e,!1}):n=+n,n},setCurrentStepIndex:function(t,n){return e("input[name=__FormCurrentStepIndex]",t.$workingForm).val(n),n},validateRegularExpressionValidator:function(e,t,n){return n&&n.model&&n.model.jsPattern&&""!==t?i.isMatchedReg(t,n.model.jsPattern)?{isValid:!0}:{isValid:!1,message:i.stringFormat(n.model.message,[n.model.jsPattern,n.description])}:{isValid:!0}},showNextStepOnEnterKeyDown:function(t){var n=i.getWorkingFormFromInnerElement(t.target),a=t.keyCode,r=e(".Form__NavigationBar .Form__NavigationBar__Action.btnNext, [data-f-type='navigationbar'] [data-f-navigation-next]",n),o=e(".Form__Element.FormSubmitButton, [data-f-type='submitbutton']",n).parent(".FormStep, [data-f-type='step']").filter(function(t){return!e(this).hasClass("hide")});return 13!==a||0!==o.length||null==r||!r.length||(t.preventDefault(),t.stopPropagation(),r.trigger("click"),!0)},scrollToTheTopOfForm:function(t){null!=t&&"fixed"!==t.css("position").toLowerCase()&&e(document).scrollTop()>0&&window.scrollTo(0,t.offset().top)}},Extension:{getSummarizedText:function(t,n,a){var r=a?"<br/>":"\n",o=a?t.ConfirmMessage:i.htmlDecodeEntities(t.ConfirmMessage),s=t.ElementsInfo,l=[],d=[],m=["__FormGuid","__FormLanguage","__FormCurrentStepIndex","__FormSubmissionId"],p=t.ConfirmMessage?o+r+r:"",f=null,u=null;for(var c in n)if(!(l.indexOf(c.replace("__TempData",""))>-1||i.isInactiveField(t,c))){var g=c.indexOf("__TempData")>-1?s[c.replace("__TempData","")]:s[c];f=g&&g.friendlyName?g.friendlyName:"",(null==(u=g&&1==g.customBinding?epi.EPiServer.Forms.CustomBindingElements[g.type](g,n[c]):n[c])||u instanceof Array&&0===u.length||e.isEmptyObject(u))&&(u=""),u instanceof Array?u=e.map(u,function(e,t){return e?"string"==typeof e?e:"object"==typeof e?e.name:void 0:null}).join(", "):u instanceof FileList&&0===u.length?u="":(u=u.toString().substr(0,46).trim()).length>=45&&(u+=" ..."),e("[name="+c+"]",t.$workingForm).hasClass("FormHideInSummarized")&&d.push(c),""==f||null==f||""==u||null==u||m.indexOf(c)>=0||d.indexOf(c)>=0||(l.push(c),p+=a?i.stringFormat("{0}: {1}"+r,[i.htmlEncodeEntities(f),i.htmlEncodeEntities(u)]):i.stringFormat("{0}: {1}"+r,[i.htmlDecodeEntities(f),u]))}return p},onBeforeSubmit:function(){var t=e.Deferred();return t.resolve(),t.promise()},showSummarizedText:function(t,n,i,a){var r=e.Deferred(),o=this.getSummarizedText(n,t,!1);return o&&""!==o.trim()?(setTimeout(function(){var e=confirm(o);r.resolve(e)},100),r.promise()):(r.resolve(!0),r.promise())},getCustomElementValue:function(e){return e.val()||e.find("[data-f-datainput]").val()},bindCustomElementValue:function(e,t){e.find(".Form__CustomInput, [data-f-datainput]").val(t)},resetCustomElementValue:function(e){e.find(".Form__CustomInput, [data-f-datainput]").val("")},getAllDataElements:function(t){return e(".Form__Element, .Form__CustomElement, [data-f-type]",t).not(".FormStep,.FormSubmitButton,.Form__Element--NonData,[data-f-type='step'],[data-f-type='form'],[data-f-type='resetbutton'],[data-f-type='submitbutton'],[data-f-element-nondata]")},isStepSatisfyDependentCondition:function(e,t){if(!e)return!1;var n=e.dependField,i=a.loadFormDataFromStorage(t.Id),r=epi.EPiServer.Forms.DependConditions[e.dependCondition];return!(n&&r&&i)||(l._isInactiveElement(n,t)?r(null,e.dependValue):r(i[n],e.dependValue))},getAntiForgeryToken:function(t){return{antiForgeryToken:e('input[name="__RequestVerificationToken"]',t.$workingForm).val()}},buildSubmitRequestHeader:function(t){var n={},i=this.getAntiForgeryToken(t);return e.extend(n,i),n}},Data:{loadCurrentFormDataFromStorage:function(e){var t=epi.EPiServer.Forms.Utils.getFormIdentifier(e);return this.loadFormDataFromStorage(t)},loadFormDataFromStorage:function(e){var t=this.getStorage()[e];return t&&(t=JSON.parse(t))||{}},saveCurrentFormDataToStorage:function(e,t){var n=epi.EPiServer.Forms.Utils.getFormIdentifier(e);return this.saveFormDataToStorage(n,t)},saveFormDataToStorage:function(e,t){var n=this.getStorage();try{n.setItem(e,JSON.stringify(t))}catch(e){console.log("Local Storage not supported: "+e.message)}return t},clearFormDataInStorage:function(e){removeFormDataInStorage(epi.EPiServer.Forms.Utils.getFormIdentifier(e))},removeFormDataInStorage:function(e){this.getStorage().removeItem(e)},getStorage:function(){return sessionStorage}},Validation:{getValidatorByValidatorType:function(e,t){if(e instanceof Array&&0!==e.length&&t)for(var n=0,i=null,a=e.length;n<a;n++)if((i=e[n])&&i.type===t)return i},getElementValidators:function(e,t){if(e instanceof Array&&0!==e.length&&t)for(var n=0,i=e.length,a=null;n<i;n++)if((a=e[n])&&(a.targetElementId===t||a.targetElementName===t))return a.validators},validateFormValue:function(t,n,i){var a=[];return e(i).each(function(i,r){var o=epi.EPiServer.Forms.Validators[r.type],s=null;if("function"==typeof o?s=o:"function"==typeof o.validate&&(s=o.validate),s){var l=s(t,n,r);e.extend(l,{fieldName:t,fieldValue:n}),a.push(l)}}),a}},Dependency:{ConditionCombinations:{All:"All",Any:"Any"},Actions:{Config:{ShowDuration:10,HideDuration:10},show:function(e){if(e.isSatisfied){e.$domElement.show(this.Config.ShowDuration),e.$domElement.removeClass("hide");var t=e.workingFormInfo.DependencyInactiveElements&&e.workingFormInfo.DependencyInactiveElements.indexOf(e.dependantInfo.fieldName);t>=0&&e.workingFormInfo.DependencyInactiveElements.splice(t,1)}else e.$domElement.hide(this.Config.HideDuration),e.workingFormInfo.DependencyInactiveElements.push(e.dependantInfo.fieldName)},hide:function(e){if(e.isSatisfied)e.$domElement.hide(this.Config.HideDuration),e.$domElement.addClass("hide"),e.workingFormInfo.DependencyInactiveElements.push(e.dependantInfo.fieldName);else{e.$domElement.show(this.Config.ShowDuration);var t=e.workingFormInfo.DependencyInactiveElements&&e.workingFormInfo.DependencyInactiveElements.indexOf(e.dependantInfo.fieldName);t>=0&&e.workingFormInfo.DependencyInactiveElements.splice(t,1)}}},DependantController:t,Dependant:n,_initDependencyInfos:function(e){var t=e.DependenciesInfo;if(t&&!(t.length<=0)){e.DependantControllers=[];for(var n=0;n<t.length;n++){var a=t[n],r={onDependencyStateChanged:function(t,n,a){i.raiseFormsEvent(e,{type:"formsDependencyStateChanged",targetElement:t,dependencyInfo:n,isConditionSatisfied:a})},workingFormInfo:e},o=new epi.EPiServer.Forms.Dependency.DependantController(a,r);e.DependantControllers.push(o)}}},_getValueOfDependeeElement:function(t,n){if(n&&t){var a=i.getElementName(t);if(!(n.DependencyInactiveElements.indexOf(a)>=0)){var r=i.getCurrentStepIndex(n),o=e(n.$steps[r]);return e(t,o).length>0?i.getElementValue(t):epi.EPiServer.Forms.Data.loadCurrentFormDataFromStorage(n.$workingForm)[a]}}},_getTriggerEventForDependeeElement:function(e){return i.isElementType(e,"textbox")?"keyup":"change"},_getTriggerEventsForDependeeElement:function(e){return i.isElementType(e,"textbox")?"number"===e.attr("data-f-modifier")?["keyup","change"]:["keyup"]:["change"]},_isElementOfInactiveSteps:function(t,n){var i=n.StepsInfo.Steps.filter(function(e){return!1===e.isActive});if(0===i.length)return!1;for(var a=0;a<i.length;a++){var r=i[a].index;if(!0!==(r===n.StepsInfo.Steps.length-1)){var o=e(n.$steps[r]).find("[data-f-datainput]"),s=e.map(o,function(t){return epi.EPiServer.Forms.Utils.getElementName(e(t))});if(s&&s.indexOf(t)>-1)return!0}}return!1},_isInactiveElement:function(e,t){return t.DependencyInactiveElements.indexOf(e)>-1||this._isElementOfInactiveSteps(e,t)}},Navigation:{findNextStep:function(e,t){var n=null,i=e+1,a=t.StepsInfo.Steps[i];if(a){var r=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(a,t);a.isActive=r,n=r?a:this.findNextStep(i,t)}return n},findPreviousStep:function(e,t){var n=null,i=e-1,a=t.StepsInfo.Steps[i];return a&&(n=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(a,t)?a:this.findPreviousStep(i,t)),n}}});var d={VisitorData:{"EPiServer.Forms.Implementation.VisitorData.GeoVisitorDataSource":function(t){e.get("/EPiServer.Forms/DataSubmit/GetGeoData").done(function(e){if(!t.val()){var n=t.data("epiforms-visitordataproperty")||t.data("f-visitordataproperty");null!=e&&e[n]&&t.val(e[n])}})}}},m={Validators:{"EPiServer.Forms.Implementation.Validation.RequiredValidator":function(e,t,n){return n&&(""==t||t&&!t.length)?{isValid:!1,message:n.model.message}:{isValid:!0}},"EPiServer.Forms.Implementation.Validation.RegularExpressionValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.EmailValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.UrlValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateDDMMYYYYValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateMMDDYYYYValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.DateYYYYMMDDValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.IntegerValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.PositiveIntegerValidator":i.validateRegularExpressionValidator,"EPiServer.Forms.Implementation.Validation.AllowedExtensionsValidator":function(e,t,n){if(!t||t instanceof Array&&0===t.length)return{isValid:!0};var i,a,r,o,s=t,l=n.model.accept,d=epi.EPiServer.Forms.UploadExtensionBlackList.split(","),m=void 0==l||l.length<1?[]:l.split(","),p=0,f=0,u=m.length,c=s.length;if(u>0)for(;p<u;p++)m[p]=m[p].substr(1);for(;f<c;f++)if(i=s[f].name,a=d,r=m,o=void 0,(o=function(e){return e.substr(2+(~-e.lastIndexOf(".")>>>0))}(i)).length<1||(o=o.toLowerCase(),a.indexOf(o)>=0||!(r.length<1||r.indexOf(o)>-1)))return{isValid:!1,message:epi.EPiServer.Forms.Utils.stringFormat(n.model.message,[l])};return{isValid:!0}},"EPiServer.Forms.Implementation.Validation.MaxFileSizeValidator":function(e,t,n){for(var i=t,a=0,r=i.length,o=n.model.sizeInBytes;a<r;a++)if(i[a].size>o)return{isValid:!1,message:epi.EPiServer.Forms.Utils.stringFormat(n.model.message,[o/1048576])};return{isValid:!0}},"EPiServer.Forms.Implementation.Validation.NumericValidator":function(e,t,n){var i;return t&&(i=t,isNaN(parseFloat(i))||!isFinite(i))?{isValid:!1,message:n.model.message}:{isValid:!0}},"EPiServer.Forms.Implementation.Validation.CaptchaValidator":{initialize:function(t){var n=this;t.parents(".FormCaptcha, [data-f-type='captcha']").find(".FormCaptcha__Refresh, [data-f-captcha-refresh]").on("click",function(t){n._refreshCaptcha(e(this)),t.preventDefault()})},validate:function(e,t,n){var i=t.trim();return{isValid:null!=i&&""!==i,message:n.model.message}},onServerValidateFailed:function(e,t){this._refreshCaptcha(e),e.focus()},_refreshCaptcha:function(e){var t=e.hasClass("FormCaptcha")||i.isElementType(e,"captcha")?e:e.parents(".FormCaptcha, [data-f-type='captcha']"),n=t.find(".FormCaptcha__Image, [data-f-captcha-image]"),a=t.find(".FormTextbox__Input, [data-f-datainput]");n.attr("src",n.attr("src")+"&d="+Math.random()),a.val("")}}}},p={DependConditions:{Equals:function(e,t){return(e=e?epi.EPiServer.Forms.Utils.getConcatString(e,",").toUpperCase():"")===(t=t?t.toUpperCase():"")},NotEquals:function(e,t){return(e=e?epi.EPiServer.Forms.Utils.getConcatString(e,",").toUpperCase():"")!==(t=t?t.toUpperCase():"")},Contains:function(e,t){return e=e?epi.EPiServer.Forms.Utils.getConcatString(e,",").toUpperCase():"",t=t?t.toUpperCase():"",e.indexOf(t)>=0},NotContains:function(e,t){return!(e=e?epi.EPiServer.Forms.Utils.getConcatString(e,","):"")&&t||e&&!t||e&&t&&e.toUpperCase().indexOf(t.toUpperCase())<0},MatchRegularExpression:function(e,t){var n=new RegExp(t,"igm");return n.ignoreCase=n.global=n.multiline=!0,!t||t&&n.test(e)}}};e.extend(!0,epi.EPiServer.Forms,d),e.extend(!0,epi.EPiServer.Forms,m),e.extend(!0,epi.EPiServer.Forms,p),e.extend(!0,epi.EPiServer.Forms,{CustomBindingElements:{}}),epi.EPiServer.Forms.init=function(){epi.EPiServer.Forms.__Initialized||(epi.EPiServer.Forms.__Initialized=!0,e(document).ready(function(){function t(t){t.preventDefault(),t.stopPropagation();var n=i.getWorkingFormFromInnerElement(t.target),s=c(n);if(!1===s.SubmittableStatus.submittable)return p(s,s.SubmittableStatus.message),!1;e.when(r.onBeforeSubmit(n)).then(function(){var d=y(s);if(!v(d,s))return S(d),E(d),!1;var f=function(t){var n=c(t),i=g(t),r=a.loadFormDataFromStorage(n.Id);return e.extend(r,i)}(n);e.when(function(t,n){var i=e.Deferred();if(!t.ShowSummarizedData)return i.resolve(!0),i.promise();return r.showSummarizedText(n,t,["__FormGuid","__FormLanguage","__FormCurrentStepIndex","__FormSubmissionId"],[])}(s,f)).then(function(a){if(!a)return!1;var r=[];for(var d in f)if(!(d.indexOf("__TempData")>-1||l._isInactiveElement(d,s)||i.getFormElementBlock(d,n).parents(".FormStep:first, [data-f-type='step']:first").hasClass("hide"))){var u=o.getElementValidators(s.ValidationInfo,d);r=r.concat(o.validateFormValue(d,f[d],u))}var c=e.grep(r,function(e){return 0==e.isValid});if(c.length>0){var g=e.map(c,function(e){return e.message});return p(s,g.join(" ")),!1}m(t)})})}function n(e){e.preventDefault(),e.stopPropagation();var t=i.getWorkingFormFromInnerElement(e.target),n=c(t);i.raiseFormsEvent(n,{type:"formsReset",sourceEvent:e}),d(t,n),h(n.StepsInfo.Steps[0],n)}function d(t,n){if(t.get(0).reset(),n.SubmittableStatus&&!1===n.SubmittableStatus.submittable?p(n,n.SubmittableStatus.message):p(n,""),a.removeFormDataInStorage(n.Id),e("[aria-invalid=true]",t).attr("aria-invalid","false"),r.getAllDataElements(t).each(function(t,n){var a=e(n);F(a).text(""),a.removeClass("ValidationFail ValidationSuccess"),a.hasClass("FormChoice")||i.isElementType(a,"choice")?a.find("input[type=checkbox], input[type=radio]").each(function(t,n){var i=e(n);i.prop("checked",!(!i.data("epiforms-default-value")&&!i.data("f-default-value")))}):a.hasClass("FormSelection")||i.isElementType(a,"selection")?(a.find("option[disabled]:eq(0)").prop("selected",!0),a.find("option").each(function(t,n){var i=e(n);!1===i.prop("disabled")&&i.prop("selected",!(!i.data("epiforms-default-value")&&!i.data("f-default-value")))})):a.hasClass("FormFileUpload")||i.isElementType(a,"fileupload")?(f(a).text(""),C(a.find(".FormFileUpload__Input, [data-f-datainput]"))):(a.hasClass("Form__CustomElement")||i.isElementType(a,"custom"))&&r.resetCustomElementValue(a)}),n.DependantControllers&&n.DependantControllers.length)for(var o=0;o<n.DependantControllers.length;o++)n.DependantControllers[o].check()}function m(t){var n=i.getWorkingFormFromInnerElement(t.target),l=epi.EPiServer.Forms.Utils.getFormIdentifier(n),m=c(n),f=y(m),g=e(t.srcElement||t.currentTarget).closest("[data-f-type='submitbutton']"),v=!!g.data("epiforms-is-progressive-submit")||!!g.data("f-is-progressive-submit");if("submitbutton"===g.data("f-type")){var E=f.find("[data-f-type=submitbutton]")[0];if(E){var I=e(E).attr("data-f-element-name");if(i.isInactiveField(m,I))return}}var x,D=a.saveFormDataToStorage(m.Id,u(n)),b=new FormData,V=i.getCurrentStepIndex(m),P=s.findNextStep(V,m),k=m.StepsInfo.Steps.length,w=V===k-1,T=!P&&w;for(var N in P||w||(P=m.StepsInfo.Steps[k-1]),T=T||!!g.data("epiforms-is-finalized")||!!g.data("f-is-finalized"),D[g.prop("name")]=g.val(),b.append("__FormGuid",l),b.append("__FormHostedPage",epi.EPiServer.CurrentPageLink),b.append("__FormLanguage",epi.EPiServer.CurrentFormLanguage),b.append("__FormCurrentStepIndex",V),b.append("__FormWithJavaScriptSupport","true"),D)if(D.hasOwnProperty(N))if(i.isInactiveField(m,N))b.append(N,"");else if(x=D[N],Array.isArray(x)&&x.length>0&&null!==x[0]&&"object"==typeof x[0]&&x[0].file&&Object.getPrototypeOf(x[0].file)===File.prototype){for(var A,$=x,U="",O=0;O<$.length;O++)A=$[O].file,b.append(N+"_file_"+O,A),U+=A.name+"|";b.append(N,U)}else b.append(N,x);i.raiseFormsEvent(m,{type:"formsStartSubmitting",formData:b}),g.prop("disabled",!0),p(m,"");var B=e.ajax({url:m.DataSubmitController+"/Submit",headers:r.buildSubmitRequestHeader(m),data:b,cache:!1,type:n.prop("method"),processData:!1,contentType:!1,async:epi.EPiServer.Forms.AsyncSubmit||n.data("epiforms-async-submit")||n.data("f-async-submit")||!1});B.done(function(r){if(t.preventDefault(),e(".Form__Element__ValidationError, [data-f-validationerror]").text(""),!0===r.IsSuccess){var s=y(m);if(e(".FormFileUpload .FormFileUpload__Input, [data-f-type='fileupload'] [data-f-datainput]",s).each(function(t,n){e(this).val(""),C(e(this))}),0==T&&0==v){i.raiseFormsEvent(m,{type:"formsNavigationNextStep",targetStep:P});var l=a.loadFormDataFromStorage(m.Id),f=e.extend(l,{__FormSubmissionId:r.Data.SubmissionId});return a.saveFormDataToStorage(m.Id,f),i.raiseFormsEvent(m,{type:"formsSubmitted",formData:b,isFinalizedSubmission:!1,isSuccess:r.IsSuccess,returnedResult:r}),h(P,m),!1}1==T&&d(n,m),i.raiseFormsEvent(m,{type:"formsSubmitted",formData:b,isFinalizedSubmission:T,isSuccess:r.IsSuccess,returnedResult:r});var u=m.StepsInfo.Steps.length;if(r.RedirectUrl)return window.location.href=r.RedirectUrl,!1;0==v&&!P&&V<u-1?h(m.StepsInfo.Steps[u-1],m):(e(".Form__MainBody, [data-f-mainbody]",m.$workingForm).hide(),p(m,r.Message,!0))}else _(m),i.raiseFormsEvent(m,{type:"formsSubmitted",formData:b,isSuccess:r.IsSuccess,returnedResult:r}),r.Message&&p(m,r.Message),r.Data&&r.Data.ValidationInfo&&r.Data.ValidationInfo.length>0&&function(t,n){for(var i=null,a=0;a<n.length;a++)if(n[a]&&n[a].InvalidElement){var r=F(i=e("#"+n[a].InvalidElement,t.$workingForm)),s=o.getElementValidators(t.ValidationInfo,n[a].InvalidElement),l=o.getValidatorByValidatorType(s,n[a].Validator);if(l){var d=epi.EPiServer.Forms.Validators[l.type],m=d.onServerValidateFailed;m&&"function"==typeof m&&m.apply(d,[i,l])}r.text(n[a].ValidationMessage||epi.EPiServer.Forms.Messages.viewMode.commonValidationFail).show()}i&&S(i.parents(".FormStep:first, [data-f-type='step']:first"))}(m,r.Data.ValidationInfo)}),B.fail(function(e,n,a){t.preventDefault(),i.raiseFormsEvent(m,{type:"formsSubmittedError",formData:b,isSuccess:!1,xhr:e,typeOfFailure:n,status:a}),p(m,n+" "+e.status+": "+a)}),B.always(function(){g.prop("disabled",!1),_(m)})}function p(t,n,i){if(t){var a=e(".Form__Status__Message, [data-f-form-statusmessage]",t.$workingForm);a.removeClass("Form__Warning__Message").removeClass("Form__Success__Message"),1==i&&n?a.removeClass("hide").addClass("Form__Success__Message").html(n):n?a.removeClass("hide").addClass("Form__Warning__Message").html(n):a.addClass("hide").html("")}}function f(e){return e.find(".FormFileUpload__PostedFile, [data-f-postedFile]")}function u(t,n){var i=c(t),r=g(y(i),n),o=a.loadFormDataFromStorage(i.Id);return e.extend(o,r)}function c(e){var t=i.getFormIdentifier(e),n=epi.EPiServer.Forms[t];return n.$workingForm=e,n}function g(t,n){var a={};return r.getAllDataElements(t).each(function(t,r){var o=e(r);if(!("function"==typeof n&&n(o)||o.parents(".FormStep:first, [data-f-type='step']:first").hasClass("hide"))){var s=i.getElementName(o);if(s)if(o.hasClass("FormFileUpload")||i.isElementType(o,"fileupload")){var l=e(".FormFileUpload__Input, [data-f-datainput]",o)[0],d=s+"__TempData";if(a[s]=[],a[d]=[],l&&0!==l.files.length)for(var m=0;m<l.files.length;m++){var p=l.files[m];a[s].push({name:p.name,file:p}),a[d].push({name:p.name})}else{var f=i.getPreviousPostedFiles(o);a[s]=f,a[d]=f}}else a[s]=i.getElementValue(o)}}),a}function v(t,n){if(!t)return!0;var a=!0;return r.getAllDataElements(t).each(function(t,r){a=function(t,n){var a=e(t),r=F(a),s=i.getElementName(a),l=a.attr("id")||s,d=o.getElementValidators(n.ValidationInfo,l),m=!0;a.removeClass("ValidationFail ValidationSuccess"),r.hide();var p=i.getElementValue(a);if(n.DependencyInactiveElements.indexOf(s)<0&&d instanceof Array&&d.length>0){var f=o.validateFormValue(s,p,d),u=e.grep(f,function(e){return!1===e.isValid}),c=e.grep(n.ValidationInfo,function(e){return e.targetElementId===l||e.targetElementName===l})[0],g=e("#"+c.targetElementId);if(u&&u.length>0){var v=e.map(u,function(e){return e.message});g.attr("aria-invalid","true"),a.addClass("ValidationFail"),r.text(v.join(" ")).show(),m=!1}else a.addClass("ValidationSuccess"),g.attr("aria-invalid","false"),m=!0}return i.raiseFormsEvent(n,{type:"elementValidated",isValid:m,elementName:s,elementValue:p,elementIdentifier:l,element:t,$messageContainer:r}),m}(r,n)&&a}),i.raiseFormsEvent(n,{type:"formsStepValidating",isValid:a}),n.$workingForm.toggleClass("ValidationSuccess",a),n.$workingForm.toggleClass("ValidationFail",!a),a}function F(t){var n=i.getElementName(t),a=i.stringFormat("{0}[data-epiforms-linked-name='{1}'], {0}[data-epiforms-linked-name='{2}']",[".Form__Element__ValidationError",n,t.attr("id")]),r=i.stringFormat("{0}[data-f-linked-name='{1}'], {0}[data-f-linked-name='{2}']",["[data-f-validationerror]",n,t.attr("id")]);return e(a).add(r)}function h(t,n){if(t)if(i.raiseFormsEvent(n,{type:"formsNavigateToStep",targetStep:t}),function(t,n){e.each(t,function(t,a){var o=-1!==t.indexOf("__TempData")?t.replace("__TempData",""):t,s=e('[data-epiforms-element-name="'+o+'"], [data-f-element-name="'+o+'"]',n);if(0!==s.length&&!s.hasClass("FormExcludeDataRebind")&&!s.data("f-excludedatarebind")){var l=s.find(".FormChoice__Input--Checkbox, [data-f-datainput]:checkbox");if(l.length>0)e.each(l,function(){var t=e(this).val();e(this).attr("checked",a.indexOf(t)>-1)});else if((l=s.find(".FormChoice__Input--Radio, [data-f-datainput]:radio")).length>0){var d=Array.isArray(a)?a[0]:a;e.each(l,function(){var t=e(this).val();e(this).attr("checked",d==t)})}else if(s.hasClass("FormSelection")||i.isElementType(s,"selection"))e("option:enabled",s).each(function(t,n){e(n).attr("selected",a.indexOf(e(n).val())>-1)});else if(!s.hasClass("FormCaptcha")&&!i.isElementType(s,"captcha"))if((l=s.find(".FormFileUpload__Input, [data-f-datainput]:file")).length>0){var m="";if(a instanceof Array&&a.length>0){var p=a.map(function(e){return e.name}).join(", ");m=m.concat(p)}if(""!==m){var u=i.stringFormat(epi.EPiServer.Forms.Messages.fileUpload.postedFile,[m]);f(s).text(u).show()}}else s.hasClass("Form__CustomElement")||i.isElementType(s,"custom")?r.bindCustomElementValue(s,a):s.find("[data-f-datainput]:first").val(a)}})}(a.loadFormDataFromStorage(n.Id),n.$workingForm),n.StepsInfo.AllStepsAreNotLinked||t.attachedContentLink==epi.EPiServer.CurrentPageLink)n.$steps.addClass("hide"),n.$steps.each(function(a,r){if(a===t.index)return e(r).removeClass("hide"),i.setCurrentStepIndex(n,t.index),!1}),i.scrollToTheTopOfForm(n.$workingForm);else{if(t.attachedUrl&&t.attachedUrl.length)return void window.location.replace(t.attachedUrl);n.StepsInfo.AllStepsAreNotLinked||p(n,epi.EPiServer.Forms.Messages.viewMode.malformStepConfiguration)}else n.$steps.hide();_(n)}function S(t){epi.EPiServer.Forms.Validators["EPiServer.Forms.Implementation.Validation.CaptchaValidator"]._refreshCaptcha(e(".Form__Element.FormCaptcha, [data-f-type='captcha']",t))}function E(t){if(t){var n=e(".Form__Element.ValidationFail",t)[0];if(n){n.scrollIntoView();var i=e("[data-f-datainput]",n);i&&i.length>0&&i[0].focus()}}}function _(t){var n=i.getCurrentStepIndex(t),a=e(".Form__NavigationBar, [data-f-type='navigationbar']",t.$workingForm);if(n<0)a.hide();else{var r=e(".Form__NavigationBar__Action.btnPrev, [data-f-navigation-previous]",a).prop("disabled",!1),o=e(".Form__NavigationBar__Action.btnNext, [data-f-navigation-next]",a).prop("disabled",!1);0!==n&&!1!==t.SubmittableStatus.submittable||r.prop("disabled",!0),n!==t.StepsInfo.Steps.length-1&&!1!==t.SubmittableStatus.submittable||o.prop("disabled",!0);var s=n+1,l=t.StepsInfo.Steps.length;e(".Form__NavigationBar, [data-f-type='navigationbar']",t.$workingForm).toggle(t.ShowNavigationBar),e(".Form__NavigationBar__ProgressBar__CurrentStep, [data-f-navigation-currentStep]",a).text(s),e(".Form__NavigationBar__ProgressBar__StepsCount, [data-f-navigation-stepcount]",a).text(l),e(".Form__NavigationBar__ProgressBar--Progress, [data-f-navigation-progress]",a).css({width:100*s/l+"%"})}}function y(t){var n=i.getCurrentStepIndex(t);return e(t.$steps[n])}function C(e){/MSIE/.test(navigator.userAgent)&&e.replaceWith(e=e.clone(!0))}a.getStorage()?(e('.EPiServerForms, [data-f-type="form"]').each(function(o,l){var d=e(l),f=c(d);f.SubmittableStatus&&!1===f.SubmittableStatus.submittable&&p(f,f.SubmittableStatus.message),function(t){if(!t||!t.StepsInfo||!t.StepsInfo.Steps)return;if(t.$steps=e(".FormStep, [data-f-type='step']",t.$workingForm),t.StepsInfo.Steps.length<2)return;h(t.StepsInfo.Steps[i.getCurrentStepIndex(t)],t),e(".Form__NavigationBar__Action.btnNext, [data-f-navigation-next]",t.$workingForm).on("click",function(n){n.preventDefault(),e.when(r.onBeforeSubmit(t.$workingForm)).then(function(){var e=y(t);if(!v(e,t))return S(e),E(e),!1;m(n)})}),e(".Form__NavigationBar__Action.btnPrev, [data-f-navigation-previous]",t.$workingForm).on("click",function(n){n.preventDefault();var r=u(t.$workingForm,function(e){return e.hasClass("FormFileUpload")||i.isElementType(e,"fileupload")});a.saveFormDataToStorage(t.Id,r);var o=s.findPreviousStep(i.getCurrentStepIndex(t),t);h(o,t);var l=e("section[data-epiforms-stepindex="+o.index+"], section[data-f-stepindex="+o.index+"]",t.$workingForm);S(l),i.raiseFormsEvent(t,{type:"formsNavigationPrevStep",targetStep:o})})}(f);for(var g=1;g<f.StepsInfo.Steps.length-1;g++){var F=f.StepsInfo.Steps[g];F.isActive=epi.EPiServer.Forms.Extension.isStepSatisfyDependentCondition(F,f)}epi.EPiServer.Forms.Dependency._initDependencyInfos(f),e(f.ValidationInfo).each(function(t,n){e(n.validators).each(function(t,i){var a=epi.EPiServer.Forms.Validators[i.type];a&&"function"==typeof a.initialize&&a.initialize(e("#"+n.targetElementId))})}),i.injectVisitorData(f),e(".Form__Element.FormSubmitButton, [data-f-type='submitbutton']",d).off("click",t).on("click",t),e(".Form__Element.FormResetButton, [data-f-type='resetbutton']",d).off("click",n).on("click",n),i.raiseFormsEvent(f,{type:"formsSetupCompleted"})}),e(".EPiServerForms .FormTextbox--Number .FormTextbox__Input, [data-f-type='form'][data-f-type='textbox'][data-f-modifier='number'] [data-f-datainput]").on("keydown",function(e){var t=e.which||e.keyCode;if(!e.shiftKey&&!e.altKey&&!e.ctrlKey&&t>=65&&t<=90||32===t)return!1;if(!e.shiftKey&&!e.altKey&&!e.ctrlKey&&t>=48&&t<=57||t>=96&&t<=105||65===e.keyCode&&!0===e.ctrlKey||67===t&&!0===e.ctrlKey||88===t&&!0===e.ctrlKey||t>=35&&t<=39||8===t||9===t||13===t||46===t||45===t)return!0;var n=this.value;return(109!==t&&189!==t||"-"!==n[0])&&(!((!(e.shiftKey||e.altKey||e.ctrlKey||190!==t)||188===t||110===t)&&/[\.,]/.test(n))&&void 0)}).on("keyup",function(e){var t=this.value;isNaN(t)&&t&&(t=(t=("-"===t[0]?"-":"")+t.replace(/[^0-9\.]/g,"")).replace(/\.(?=(.*)\.)+/g,""),this.value=t)}),e('.EPiServerForms input.FormTextbox__Input,.FormChoice__Input.FormChoice__Input--Checkbox,.FormRange__Input,.FormTextbox__Input.FormUrl__Input,.FormChoice__Input.FormChoice__Input--Radio,.FormTextbox__Input.FormCaptcha__Input.FormHideInSummarized,[data-f-type="form"] [data-f-datainput]:not(textarea)').on("keydown",function(e){return i.showNextStepOnEnterKeyDown(e)})):e('.EPiServerForms .Form__Status__Message, [data-f-type="form"] [data-f-form-statusmessage]').text(epi.EPiServer.Forms.ErrorMessages.cantnotworkwithoutstorage)}))},epi.EPiServer.Forms.ExternalScriptSources.length<=0&&epi.EPiServer.Forms.ExternalCssSources.length<=0?epi.EPiServer.Forms.init():(i.loadExternalScriptOnDemand(epi.EPiServer.Forms.ExternalScriptSources,function(){i.raiseFormsEvent(null,{type:"formsLoadExternalScripts",scripts:epi.EPiServer.Forms.ExternalScriptSources}),epi.EPiServer.Forms.init()}),i.loadExternalCssOnDemand(epi.EPiServer.Forms.ExternalCssSources,function(){i.raiseFormsEvent(null,{type:"formsLoadExternalCss",Css:epi.EPiServer.Forms.ExternalCssSources})}))}else console.error("Forms cannot work without jQuery.");else console.error("Forms is not initialized correctly.")}($$epiforms||$);